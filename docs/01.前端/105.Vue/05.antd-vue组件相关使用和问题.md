---
title: antd-vue组件相关使用和问题
date: 2024-06-18 09:55:50
permalink: /pages/6c7bcb/
categories:
  - 前端
  - Vue
tags:
  - 
author: 
  name: 李丁丁
  link: https://github.com/fallenaAngel
---

::: tip
ant-design-vue@1.7.2，vue@2.7.13
:::

## a-select vModel时placeholder不显示问题

问题描述：select 组件绑定了v-model和placeholder，v-model的value默认值为空字符串或者null时，select组件的placeholder属性不显示

```js
<a-select v-model="value" placeholder="请选择">
  <a-select-option value="test">test</a-select-option>
</a-select>
```

placeholder是当前组件值为空时显示的替换文本，只有值为空的时候才会显示。那我理解空字符串和null在js中都可以是值为空的概念，为什么不显示placeholder呢？

因为在ant-design-vue中，当组件绑定了v-model且绑定值初始化时，值不再是空，即时初始化值为’'也视为有值，所以placeholder自然就不会显示。

那么怎么样才能代表值没初始化呢？两个办法：

1. 定义对象，v-model绑定form.value，在data里面定义form空对象，此时value这个就是未初始化的
2. value初始化未undefined，也能代表是未初始化的

其实两个方案是一个原理，初始化成undefined未定义就好啦。

## a-space下两个按钮点击触发事件问题

问题描述：child组件使用a-space，里面放a b 2个按钮，其中b按钮默认隐藏了并且使用vIf动态逻辑判断显示，之后提供插槽，允许parent组件通过插槽给b后面插入自定义按钮，这儿插入c按钮，问题就是c点击时触发了b绑定的按钮事件回调。

```vue
<template>
  <a-space>
    <a-button @click="onClick1">按钮1</a-button>
    <a-button v-if="show" @click="onClick2">按钮2</a-button>
    <a-button @click="onClick3">按钮3</a-button>
  </a-space>
</template>
<script>
export default {
  data () {
    return {
      show: false
    }
  },
  mounted () {
    setTimeOut(() => {
      this.show = true
    }, 300)
  }
}
</script>
```

通过多番调试，最终确认，a-space下b按钮本身v-if切换时，插槽插入的c按钮就是会走b的事件回调。猜测原因可能是ant-design-vue的a-space组件内部有子元素处理逻辑有bug导致这儿事件绑定有问题，其实是因为当 v-if 动态切换某个按钮的显示状态时，Vue 可能会复用现有的 DOM 元素，而不是销毁并重新创建它们。这种优化行为可能会导致事件监听器绑定到错误的元素上，从而引发点击事件的错位。

解决办法：

1. b按钮v-if改为v-show
2. 插槽放a-space外面
3. 可以通过为每个按钮添加一个唯一的 key 属性，确保 Vue 在处理 v-if 时能够正确识别和更新每个元素。这将避免事件监听器绑定错位的问题
